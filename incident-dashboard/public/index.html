<h1>Monitoring Incident</h1>
<div id="incident"></div>
<button id="generate-pdf" style="display:none">Générer PDF</button>

<script>
async function fetchIncident() {
  const res = await fetch("/incident");
  const data = await res.json();
  const incidentDiv = document.getElementById("incident");
  const pdfBtn = document.getElementById("generate-pdf");

  if(data.incident) {
    incidentDiv.innerHTML = `
      <h2>${data.incident} (${data.severity})</h2>
      <ul>
        ${data.actions.map(a => `<li>${a} <button onclick="runAction('${a}')">Exécuter</button></li>`).join("")}
      </ul>
    `;
    pdfBtn.style.display = "inline-block";
  } else {
    incidentDiv.innerHTML = "<p>Tout est OK ✅</p>";
    pdfBtn.style.display = "none";
  }
}

// Simuler l’exécution d’une action
function runAction(action) {
  alert(`Tu peux exécuter la commande correspondante à : ${action}`);
}

// Actualiser toutes les 10 secondes
setInterval(fetchIncident, 10000);
fetchIncident();

// Bouton PDF
document.getElementById("generate-pdf").onclick = async () => {
  window.open("/generate-pdf");
}
</script>
