<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Incident Dashboard</title>
  <style>
    body {
      font-family: Arial;
      background: #0f172a;
      color: white;
      padding: 40px;
    }
    .card {
      background: #1e293b;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
    }
    .p1 {
      color: #ef4444;
      font-weight: bold;
    }
    button {
      margin-top: 15px;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      background: #3b82f6;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #2563eb; }
  </style>
</head>
<body>

  <div class="card">
    <h2>Monitoring Incident</h2>
    <div id="result">Chargement...</div>
    <button id="generatePdf" style="display:none;">ðŸ“„ GÃ©nÃ©rer rapport PDF</button>
  </div>

  <script>
    const resultDiv = document.getElementById("result");
    const pdfBtn = document.getElementById("generatePdf");

    async function fetchIncident() {
      try {
        const res = await fetch("/incident");
        const data = await res.json();

        if(!data.incident) {
          resultDiv.innerHTML = "âœ… Aucun incident dÃ©tectÃ©";
          pdfBtn.style.display = "inline-block"; // bouton PDF seulement si aucun incident
        } else {
          resultDiv.innerHTML = `
            <p class="p1">${data.incident} (${data.severity})</p>
            <ul>
              ${data.actions.map(a => `<li>${a} <code>${data.commands[a] || ""}</code></li>`).join("")}
            </ul>
          `;
          pdfBtn.style.display = "none";
        }
      } catch(e) {
        resultDiv.innerText = "âš ï¸ Erreur monitoring";
        pdfBtn.style.display = "none";
      }
    }

    // Auto-refresh toutes les 5 secondes
    setInterval(fetchIncident, 5000);
    fetchIncident();

    // Bouton pour gÃ©nÃ©rer PDF
    pdfBtn.addEventListener("click", () => {
      window.location.href = "/generate-pdf";
    });
  </script>

</body>
</html>
