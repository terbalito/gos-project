<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Incident Dashboard</title>
  <style>
    body {
      font-family: Arial;
      background: #0f172a;
      color: white;
      padding: 40px;
    }
    .card {
      background: #1e293b;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
    }
    .p1 {
      color: #ef4444;
      font-weight: bold;
    }
    button {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #3b82f6;
      color: white;
    }
    li {
      margin-bottom: 6px;
    }
  </style>
</head>
<body>

  <div class="card">
    <h2>Monitoring Incident</h2>
    <div id="result">Chargement...</div>
    <button id="generate-pdf" style="display:none">Générer PDF</button>
  </div>

  <script>
    async function fetchIncident() {
      const res = await fetch("/incident");
      const data = await res.json();
      const div = document.getElementById("result");
      const pdfBtn = document.getElementById("generate-pdf");

      if(!data.incident) {
        div.innerHTML = "✅ Aucun incident détecté";
        pdfBtn.style.display = "none";
      } else {
        div.innerHTML = `
          <p class="p1">${data.incident} (${data.severity})</p>
          <ul>
            ${data.actions.map(a => `
              <li>
                ${a} 
                <br><small>Commande suggérée : <code>${data.commands[a] || "N/A"}</code></small>
              </li>
            `).join("")}
          </ul>
        `;
        pdfBtn.style.display = "inline-block";
      }
    }

    setInterval(fetchIncident, 10000);
    fetchIncident();

    // Bouton PDF
    document.getElementById("generate-pdf").onclick = async () => {
      window.open("/generate-pdf");
    }
  </script>

</body>
</html>
